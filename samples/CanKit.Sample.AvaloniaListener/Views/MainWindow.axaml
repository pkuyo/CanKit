<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CanKit.Sample.AvaloniaListener.ViewModels"
        xmlns:m="using:CanKit.Sample.AvaloniaListener.Models"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="700"
        x:Class="CanKit.Sample.AvaloniaListener.Views.MainWindow"
        x:DataType="vm:MainViewModel"
		xmlns:conv="using:CanKit.Sample.AvaloniaListener.Converters"
        Title="CanKit CAN Listener (Avalonia)">

    <Design.DataContext>
        <vm:MainViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="TextBlock.header">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,8,0,4"/>
        </Style>
    </Window.Styles>
	<Window.Resources>
		<conv:BitrateConverter x:Key="BitrateConv"/>
	</Window.Resources>
    <Grid RowDefinitions="Auto,Auto,Auto,*" ColumnDefinitions="*">
        <!-- Endpoint Selection -->
        <StackPanel Margin="8" Orientation="Horizontal" Spacing="8">
            <TextBlock Text="Endpoint" VerticalAlignment="Center"/>
            <ComboBox Width="360" ItemsSource="{Binding Endpoints}" SelectedItem="{Binding SelectedEndpoint}">
                <ComboBox.ItemTemplate>
                    <DataTemplate x:DataType="m:EndpointInfo">
                        <TextBlock Text="{Binding DisplayName}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBox Width="360" Watermark="custom endpoint..." Text="{Binding CustomEndpoint}" IsVisible="{Binding IsCustomSelected}"/>
            <Button Content="Refresh" Command="{Binding RefreshEndpointsCommand}"/>
            <Button Content="Query Caps" Command="{Binding OpenCustomEndpointCommand}"/>
        </StackPanel>

        <!-- Options (moved to dialog) -->
        <StackPanel Grid.Row="1" Margin="8" Orientation="Horizontal" Spacing="12">
            <Button Content="Options..." Click="OnOpenOptions"/>
        </StackPanel>

        <!-- Actions / Status -->
        <StackPanel Grid.Row="2" Margin="8" Orientation="Horizontal" Spacing="12">
            <Button Content="Start" Command="{Binding StartListeningCommand}"/>
            <Button Content="Stop" Command="{Binding StopListeningCommand}"/>
            <Button Content="Send..." Click="OnOpenSend"/>
            <Button Content="Periodic..." Click="OnOpenPeriodic"/>
            <TextBlock Text="TEC:" VerticalAlignment="Center" IsVisible="{Binding SupportsErrorCounters}"/>
            <TextBlock Text="{Binding Tec}" VerticalAlignment="Center" IsVisible="{Binding SupportsErrorCounters}"/>
            <TextBlock Text="REC:" Margin="16,0,0,0" VerticalAlignment="Center" IsVisible="{Binding SupportsErrorCounters}"/>
            <TextBlock Text="{Binding Rec}" VerticalAlignment="Center" IsVisible="{Binding SupportsErrorCounters}"/>
            <TextBlock Text="Bus Usage:" Margin="16,0,0,0" VerticalAlignment="Center" IsVisible="{Binding BusUsage}"/>
            <TextBlock Text="{Binding BusUsage}" VerticalAlignment="Center" IsVisible="{Binding BusUsage}"/>
        </StackPanel>

        <!-- Main Content: Frames and Logs -->
        <Grid Grid.Row="3" Margin="8" ColumnDefinitions="3*,2*" RowDefinitions="*">
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Classes="header" Text="Frames"/>
                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding Frames}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          FontSize="14"
                          RowHeight="28"
                          ColumnHeaderHeight="32"
                          Margin="0,2,0,0">
                    <DataGrid.Styles>
                        <Style Selector="DataGridColumnHeader">
                            <Setter Property="FontSize" Value="14"/>
                        </Style>
                        <Style Selector="DataGridCell TextBlock">
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="FontFamily" Value="Consolas"/>
                        </Style>
                    </DataGrid.Styles>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Time" Binding="{Binding Time}" Width="120"/>
                        <DataGridTextColumn Header="Dir"  Binding="{Binding Dir}"  Width="40"/>
                        <DataGridTextColumn Header="Kind" Binding="{Binding Kind}" Width="40"/>
                        <DataGridTextColumn Header="Id"   Binding="{Binding Id}"   Width="120"/>
                        <DataGridTextColumn Header="Dlc"  Binding="{Binding Dlc}"  Width="40"/>
                        <DataGridTextColumn Header="Data" Binding="{Binding Data}" Width="*">
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Classes="header" Text="Logs"/>
                <ListBox Grid.Row="1" ItemsSource="{Binding Logs}"/>
            </Grid>
        </Grid>
    </Grid>

</Window>
